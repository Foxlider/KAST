<Page
    x:Class="KAST.Desktop.Views.ModsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:helpers="using:KAST.Desktop.Helpers" 
    xmlns:models="using:KAST.Core.Models"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:ModIDConverter x:Key="ModIDConverter" />
        <helpers:BoolToVisConverter x:Key="BoolToVisConverter"/>
        <helpers:DataSizeConverter x:Key="DataSizeConverter"/>
    </Page.Resources>
    <Grid x:Name="ContentArea">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <TextBox Name="tbMSD" Grid.Column="0" Text="" IsSpellCheckEnabled="False"
                                 Header="Mod Staging Directory" Margin="0, 5"/>
            <Button Content="&#xE8B7;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                                HorizontalAlignment="Stretch"
                                Grid.Column="1" VerticalAlignment="Bottom" Padding="3" Foreground="{ThemeResource SystemAccentColor}"
                                Style="{ThemeResource AlternateCloseButtonStyle}"/>
        </Grid>
        <NavigationViewItemSeparator Grid.Row="1" Margin="0,5"/>
        <controls:DataGrid
            Grid.Row="2" d:DataContext="{d:DesignInstance Type=models:Mod}"
            AutoGenerateColumns="False"
            GridLinesVisibility="Horizontal" IsReadOnly="True"
            ItemsSource="{x:Bind ViewModel.Source, Mode=OneWay}">
            <controls:DataGrid.Resources>
                <SolidColorBrush x:Key="DataGridColumnHeaderBackgroundColor" Color="Transparent" />
            </controls:DataGrid.Resources>
            <controls:DataGrid.Columns>
                <!-- TODO: Replace column definitions to match real data. Consider adding Header values to Resources.resw. -->
                <controls:DataGridTemplateColumn>
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Margin="3">
                                <FontIcon Glyph="&#xE8B7;" FontFamily="{StaticResource SymbolThemeFontFamily}" Visibility="{Binding Path=IsLocal, Converter={StaticResource BoolToVisConverter}}"/>
                                <PathIcon Height="26" Width="26" Visibility="{Binding Path=IsLocal, Converter={StaticResource BoolToVisConverter}, ConverterParameter=Reverse}" Data="M11.979 0C5.678 0 .511 4.86.022 11.037l6.432 2.658c.545-.371 1.203-.59 1.912-.59.063 0 .125.004.188.006l2.861-4.142V8.91c0-2.495 2.028-4.524 4.524-4.524 2.494 0 4.524 2.031 4.524 4.527s-2.03 4.525-4.524 4.525h-.105l-4.076 2.911c0 .052.004.105.004.159 0 1.875-1.515 3.396-3.39 3.396-1.635 0-3.016-1.173-3.331-2.727L.436 15.27C1.862 20.307 6.486 24 11.979 24c6.627 0 11.999-5.373 11.999-12S18.605 0 11.979 0zM7.54 18.21l-1.473-.61c.262.543.714.999 1.314 1.25 1.297.539 2.793-.076 3.332-1.375.263-.63.264-1.319.005-1.949s-.75-1.121-1.377-1.383c-.624-.26-1.29-.249-1.878-.03l1.523.63c.956.4 1.409 1.5 1.009 2.455-.397.957-1.497 1.41-2.454 1.012H7.54zm11.415-9.303c0-1.662-1.353-3.015-3.015-3.015-1.665 0-3.015 1.353-3.015 3.015 0 1.665 1.35 3.015 3.015 3.015 1.663 0 3.015-1.35 3.015-3.015zm-5.273-.005c0-1.252 1.013-2.266 2.265-2.266 1.249 0 2.266 1.014 2.266 2.266 0 1.251-1.017 2.265-2.266 2.265-1.253 0-2.265-1.014-2.265-2.265z"/>
                            </Grid>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                </controls:DataGridTemplateColumn>
                <controls:DataGridTextColumn Binding="{Binding ModID, Converter={StaticResource ModIDConverter}}" Header="ID" />
                <controls:DataGridTextColumn Binding="{Binding Name}" Header="Name" Width="2*" />
                <controls:DataGridTextColumn Binding="{Binding Author.Name}" Header="Author" />
                <controls:DataGridTextColumn Binding="{Binding ModStatus}" Header="Status" />
                <controls:DataGridTextColumn Binding="{Binding ActualSize, Converter={StaticResource DataSizeConverter}}" Header="Actual Size" />
                <controls:DataGridTemplateColumn Header="Update" CanUserResize="False">
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Height="36" Visibility="{Binding Path=IsLocal, Converter={StaticResource BoolToVisConverter}, ConverterParameter=Reverse}">
                                <Grid Visibility="{Binding Path=IsLoading, Converter={StaticResource BoolToVisConverter}, ConverterParameter=Reverse}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>
                                    <Button Margin="1" Grid.Column="0" Content="&#xE895;" FontFamily="{StaticResource SymbolThemeFontFamily}" ToolTipService.ToolTip="Check Steam for Updates"
                                            HorizontalAlignment="Stretch" Style="{ThemeResource AccentButtonStyle}" VerticalAlignment="Stretch"/>
                                    <Button Margin="1" Grid.Column="1" Content="&#xE896;" FontFamily="{StaticResource SymbolThemeFontFamily}" Click="Button_Click" ToolTipService.ToolTip="Update Mod"
                                            HorizontalAlignment="Stretch" Style="{ThemeResource AccentButtonStyle}" VerticalAlignment="Stretch"/>
                                </Grid>
                                <ProgressRing Margin="2" IsIndeterminate="True" IsActive="{Binding IsLoading}" Visibility="{Binding Path=IsLoading, Converter={StaticResource BoolToVisConverter}}"/>
                            </Grid>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                </controls:DataGridTemplateColumn>

                <controls:DataGridTemplateColumn Header="Infos">
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Width="76" Height="36">
                                <Button Height="36" Width="36" Margin="1" Padding="0" Click="Button_Click" 
                                        Content="&#xE774;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                                        Style="{ThemeResource AccentButtonStyle}" ToolTipService.ToolTip="Open Mod Page"
                                        BorderThickness="0" HorizontalAlignment="Center"
                                        Visibility="{Binding Path=IsLocal, Converter={StaticResource BoolToVisConverter}, ConverterParameter=Reverse}" />
                                <Button Height="36" Width="36" Padding="0" Margin="1" Click="Button_Click" 
                                        Content="&#xE8B7;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                                        Style="{ThemeResource AccentButtonStyle}" ToolTipService.ToolTip="Open Mod Folder"
                                        BorderThickness="0" HorizontalAlignment="Center"
                                        Visibility="{Binding Path=IsLocal, Converter={StaticResource BoolToVisConverter}, ConverterParameter=Reverse}" />
                                <Button Height="36" Width="74" Padding="0" Margin="1,1" Click="Button_Click" 
                                        Content="&#xE8B7;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                                        Style="{ThemeResource AccentButtonStyle}"  ToolTipService.ToolTip="Open Mod Folder"
                                        BorderThickness="0" HorizontalAlignment="Center"
                                        Visibility="{Binding Path=IsLocal, Converter={StaticResource BoolToVisConverter}}" />
                            </StackPanel>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                </controls:DataGridTemplateColumn>

            </controls:DataGrid.Columns>
        </controls:DataGrid>
    </Grid>
</Page>
